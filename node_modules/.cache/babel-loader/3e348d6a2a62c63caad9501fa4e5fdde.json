{"ast":null,"code":"/**\n * Copyright 2013 vtt.js Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\nvar document = require('global/document');\n\nvar _objCreate = Object.create || function () {\n  function F() {}\n\n  return function (o) {\n    if (arguments.length !== 1) {\n      throw new Error('Object.create shim only accepts one parameter.');\n    }\n\n    F.prototype = o;\n    return new F();\n  };\n}(); // Creates a new ParserError object from an errorData object. The errorData\n// object should have default code and message properties. The default message\n// property can be overriden by passing in a message parameter.\n// See ParsingError.Errors below for acceptable errors.\n\n\nfunction ParsingError(errorData, message) {\n  this.name = \"ParsingError\";\n  this.code = errorData.code;\n  this.message = message || errorData.message;\n}\n\nParsingError.prototype = _objCreate(Error.prototype);\nParsingError.prototype.constructor = ParsingError; // ParsingError metadata for acceptable ParsingErrors.\n\nParsingError.Errors = {\n  BadSignature: {\n    code: 0,\n    message: \"Malformed WebVTT signature.\"\n  },\n  BadTimeStamp: {\n    code: 1,\n    message: \"Malformed time stamp.\"\n  }\n}; // Try to parse input as a time stamp.\n\nfunction parseTimeStamp(input) {\n  function computeSeconds(h, m, s, f) {\n    return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\n  }\n\n  var m = input.match(/^(\\d+):(\\d{1,2})(:\\d{1,2})?\\.(\\d{3})/);\n\n  if (!m) {\n    return null;\n  }\n\n  if (m[3]) {\n    // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\n    return computeSeconds(m[1], m[2], m[3].replace(\":\", \"\"), m[4]);\n  } else if (m[1] > 59) {\n    // Timestamp takes the form of [hours]:[minutes].[milliseconds]\n    // First position is hours as it's over 59.\n    return computeSeconds(m[1], m[2], 0, m[4]);\n  } else {\n    // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\n    return computeSeconds(0, m[1], m[2], m[4]);\n  }\n} // A settings object holds key/value pairs and will ignore anything but the first\n// assignment to a specific key.\n\n\nfunction Settings() {\n  this.values = _objCreate(null);\n}\n\nSettings.prototype = {\n  // Only accept the first assignment to any key.\n  set: function (k, v) {\n    if (!this.get(k) && v !== \"\") {\n      this.values[k] = v;\n    }\n  },\n  // Return the value for a key, or a default value.\n  // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\n  // a number of possible default values as properties where 'defaultKey' is\n  // the key of the property that will be chosen; otherwise it's assumed to be\n  // a single value.\n  get: function (k, dflt, defaultKey) {\n    if (defaultKey) {\n      return this.has(k) ? this.values[k] : dflt[defaultKey];\n    }\n\n    return this.has(k) ? this.values[k] : dflt;\n  },\n  // Check whether we have a value for a key.\n  has: function (k) {\n    return k in this.values;\n  },\n  // Accept a setting if its one of the given alternatives.\n  alt: function (k, v, a) {\n    for (var n = 0; n < a.length; ++n) {\n      if (v === a[n]) {\n        this.set(k, v);\n        break;\n      }\n    }\n  },\n  // Accept a setting if its a valid (signed) integer.\n  integer: function (k, v) {\n    if (/^-?\\d+$/.test(v)) {\n      // integer\n      this.set(k, parseInt(v, 10));\n    }\n  },\n  // Accept a setting if its a valid percentage.\n  percent: function (k, v) {\n    var m;\n\n    if (m = v.match(/^([\\d]{1,3})(\\.[\\d]*)?%$/)) {\n      v = parseFloat(v);\n\n      if (v >= 0 && v <= 100) {\n        this.set(k, v);\n        return true;\n      }\n    }\n\n    return false;\n  }\n}; // Helper function to parse input into groups separated by 'groupDelim', and\n// interprete each group as a key/value pair separated by 'keyValueDelim'.\n\nfunction parseOptions(input, callback, keyValueDelim, groupDelim) {\n  var groups = groupDelim ? input.split(groupDelim) : [input];\n\n  for (var i in groups) {\n    if (typeof groups[i] !== \"string\") {\n      continue;\n    }\n\n    var kv = groups[i].split(keyValueDelim);\n\n    if (kv.length !== 2) {\n      continue;\n    }\n\n    var k = kv[0];\n    var v = kv[1];\n    callback(k, v);\n  }\n}\n\nfunction parseCue(input, cue, regionList) {\n  // Remember the original input if we need to throw an error.\n  var oInput = input; // 4.1 WebVTT timestamp\n\n  function consumeTimeStamp() {\n    var ts = parseTimeStamp(input);\n\n    if (ts === null) {\n      throw new ParsingError(ParsingError.Errors.BadTimeStamp, \"Malformed timestamp: \" + oInput);\n    } // Remove time stamp from input.\n\n\n    input = input.replace(/^[^\\sa-zA-Z-]+/, \"\");\n    return ts;\n  } // 4.4.2 WebVTT cue settings\n\n\n  function consumeCueSettings(input, cue) {\n    var settings = new Settings();\n    parseOptions(input, function (k, v) {\n      switch (k) {\n        case \"region\":\n          // Find the last region we parsed with the same region id.\n          for (var i = regionList.length - 1; i >= 0; i--) {\n            if (regionList[i].id === v) {\n              settings.set(k, regionList[i].region);\n              break;\n            }\n          }\n\n          break;\n\n        case \"vertical\":\n          settings.alt(k, v, [\"rl\", \"lr\"]);\n          break;\n\n        case \"line\":\n          var vals = v.split(\",\"),\n              vals0 = vals[0];\n          settings.integer(k, vals0);\n          settings.percent(k, vals0) ? settings.set(\"snapToLines\", false) : null;\n          settings.alt(k, vals0, [\"auto\"]);\n\n          if (vals.length === 2) {\n            settings.alt(\"lineAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n          }\n\n          break;\n\n        case \"position\":\n          vals = v.split(\",\");\n          settings.percent(k, vals[0]);\n\n          if (vals.length === 2) {\n            settings.alt(\"positionAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n          }\n\n          break;\n\n        case \"size\":\n          settings.percent(k, v);\n          break;\n\n        case \"align\":\n          settings.alt(k, v, [\"start\", \"center\", \"end\", \"left\", \"right\"]);\n          break;\n      }\n    }, /:/, /\\s/); // Apply default values for any missing fields.\n\n    cue.region = settings.get(\"region\", null);\n    cue.vertical = settings.get(\"vertical\", \"\");\n\n    try {\n      cue.line = settings.get(\"line\", \"auto\");\n    } catch (e) {}\n\n    cue.lineAlign = settings.get(\"lineAlign\", \"start\");\n    cue.snapToLines = settings.get(\"snapToLines\", true);\n    cue.size = settings.get(\"size\", 100); // Safari still uses the old middle value and won't accept center\n\n    try {\n      cue.align = settings.get(\"align\", \"center\");\n    } catch (e) {\n      cue.align = settings.get(\"align\", \"middle\");\n    }\n\n    try {\n      cue.position = settings.get(\"position\", \"auto\");\n    } catch (e) {\n      cue.position = settings.get(\"position\", {\n        start: 0,\n        left: 0,\n        center: 50,\n        middle: 50,\n        end: 100,\n        right: 100\n      }, cue.align);\n    }\n\n    cue.positionAlign = settings.get(\"positionAlign\", {\n      start: \"start\",\n      left: \"start\",\n      center: \"center\",\n      middle: \"center\",\n      end: \"end\",\n      right: \"end\"\n    }, cue.align);\n  }\n\n  function skipWhitespace() {\n    input = input.replace(/^\\s+/, \"\");\n  } // 4.1 WebVTT cue timings.\n\n\n  skipWhitespace();\n  cue.startTime = consumeTimeStamp(); // (1) collect cue start time\n\n  skipWhitespace();\n\n  if (input.substr(0, 3) !== \"-->\") {\n    // (3) next characters must match \"-->\"\n    throw new ParsingError(ParsingError.Errors.BadTimeStamp, \"Malformed time stamp (time stamps must be separated by '-->'): \" + oInput);\n  }\n\n  input = input.substr(3);\n  skipWhitespace();\n  cue.endTime = consumeTimeStamp(); // (5) collect cue end time\n  // 4.1 WebVTT cue settings list.\n\n  skipWhitespace();\n  consumeCueSettings(input, cue);\n} // When evaluating this file as part of a Webpack bundle for server\n// side rendering, `document` is an empty object.\n\n\nvar TEXTAREA_ELEMENT = document.createElement && document.createElement(\"textarea\");\nvar TAG_NAME = {\n  c: \"span\",\n  i: \"i\",\n  b: \"b\",\n  u: \"u\",\n  ruby: \"ruby\",\n  rt: \"rt\",\n  v: \"span\",\n  lang: \"span\"\n}; // 5.1 default text color\n// 5.2 default text background color is equivalent to text color with bg_ prefix\n\nvar DEFAULT_COLOR_CLASS = {\n  white: 'rgba(255,255,255,1)',\n  lime: 'rgba(0,255,0,1)',\n  cyan: 'rgba(0,255,255,1)',\n  red: 'rgba(255,0,0,1)',\n  yellow: 'rgba(255,255,0,1)',\n  magenta: 'rgba(255,0,255,1)',\n  blue: 'rgba(0,0,255,1)',\n  black: 'rgba(0,0,0,1)'\n};\nvar TAG_ANNOTATION = {\n  v: \"title\",\n  lang: \"lang\"\n};\nvar NEEDS_PARENT = {\n  rt: \"ruby\"\n}; // Parse content into a document fragment.\n\nfunction parseContent(window, input) {\n  function nextToken() {\n    // Check for end-of-string.\n    if (!input) {\n      return null;\n    } // Consume 'n' characters from the input.\n\n\n    function consume(result) {\n      input = input.substr(result.length);\n      return result;\n    }\n\n    var m = input.match(/^([^<]*)(<[^>]*>?)?/); // If there is some text before the next tag, return it, otherwise return\n    // the tag.\n\n    return consume(m[1] ? m[1] : m[2]);\n  }\n\n  function unescape(s) {\n    TEXTAREA_ELEMENT.innerHTML = s;\n    s = TEXTAREA_ELEMENT.textContent;\n    TEXTAREA_ELEMENT.textContent = \"\";\n    return s;\n  }\n\n  function shouldAdd(current, element) {\n    return !NEEDS_PARENT[element.localName] || NEEDS_PARENT[element.localName] === current.localName;\n  } // Create an element for this tag.\n\n\n  function createElement(type, annotation) {\n    var tagName = TAG_NAME[type];\n\n    if (!tagName) {\n      return null;\n    }\n\n    var element = window.document.createElement(tagName);\n    var name = TAG_ANNOTATION[type];\n\n    if (name && annotation) {\n      element[name] = annotation.trim();\n    }\n\n    return element;\n  }\n\n  var rootDiv = window.document.createElement(\"div\"),\n      current = rootDiv,\n      t,\n      tagStack = [];\n\n  while ((t = nextToken()) !== null) {\n    if (t[0] === '<') {\n      if (t[1] === \"/\") {\n        // If the closing tag matches, move back up to the parent node.\n        if (tagStack.length && tagStack[tagStack.length - 1] === t.substr(2).replace(\">\", \"\")) {\n          tagStack.pop();\n          current = current.parentNode;\n        } // Otherwise just ignore the end tag.\n\n\n        continue;\n      }\n\n      var ts = parseTimeStamp(t.substr(1, t.length - 2));\n      var node;\n\n      if (ts) {\n        // Timestamps are lead nodes as well.\n        node = window.document.createProcessingInstruction(\"timestamp\", ts);\n        current.appendChild(node);\n        continue;\n      }\n\n      var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/); // If we can't parse the tag, skip to the next tag.\n\n      if (!m) {\n        continue;\n      } // Try to construct an element, and ignore the tag if we couldn't.\n\n\n      node = createElement(m[1], m[3]);\n\n      if (!node) {\n        continue;\n      } // Determine if the tag should be added based on the context of where it\n      // is placed in the cuetext.\n\n\n      if (!shouldAdd(current, node)) {\n        continue;\n      } // Set the class list (as a list of classes, separated by space).\n\n\n      if (m[2]) {\n        var classes = m[2].split('.');\n        classes.forEach(function (cl) {\n          var bgColor = /^bg_/.test(cl); // slice out `bg_` if it's a background color\n\n          var colorName = bgColor ? cl.slice(3) : cl;\n\n          if (DEFAULT_COLOR_CLASS.hasOwnProperty(colorName)) {\n            var propName = bgColor ? 'background-color' : 'color';\n            var propValue = DEFAULT_COLOR_CLASS[colorName];\n            node.style[propName] = propValue;\n          }\n        });\n        node.className = classes.join(' ');\n      } // Append the node to the current node, and enter the scope of the new\n      // node.\n\n\n      tagStack.push(m[1]);\n      current.appendChild(node);\n      current = node;\n      continue;\n    } // Text nodes are leaf nodes.\n\n\n    current.appendChild(window.document.createTextNode(unescape(t)));\n  }\n\n  return rootDiv;\n} // This is a list of all the Unicode characters that have a strong\n// right-to-left category. What this means is that these characters are\n// written right-to-left for sure. It was generated by pulling all the strong\n// right-to-left characters out of the Unicode data table. That table can\n// found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\n\n\nvar strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6], [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d], [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6], [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5], [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815], [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858], [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f], [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c], [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1], [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc], [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808], [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855], [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f], [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13], [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58], [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72], [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f], [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32], [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42], [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f], [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59], [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62], [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77], [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b], [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\n\nfunction isStrongRTLChar(charCode) {\n  for (var i = 0; i < strongRTLRanges.length; i++) {\n    var currentRange = strongRTLRanges[i];\n\n    if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction determineBidi(cueDiv) {\n  var nodeStack = [],\n      text = \"\",\n      charCode;\n\n  if (!cueDiv || !cueDiv.childNodes) {\n    return \"ltr\";\n  }\n\n  function pushNodes(nodeStack, node) {\n    for (var i = node.childNodes.length - 1; i >= 0; i--) {\n      nodeStack.push(node.childNodes[i]);\n    }\n  }\n\n  function nextTextNode(nodeStack) {\n    if (!nodeStack || !nodeStack.length) {\n      return null;\n    }\n\n    var node = nodeStack.pop(),\n        text = node.textContent || node.innerText;\n\n    if (text) {\n      // TODO: This should match all unicode type B characters (paragraph\n      // separator characters). See issue #115.\n      var m = text.match(/^.*(\\n|\\r)/);\n\n      if (m) {\n        nodeStack.length = 0;\n        return m[0];\n      }\n\n      return text;\n    }\n\n    if (node.tagName === \"ruby\") {\n      return nextTextNode(nodeStack);\n    }\n\n    if (node.childNodes) {\n      pushNodes(nodeStack, node);\n      return nextTextNode(nodeStack);\n    }\n  }\n\n  pushNodes(nodeStack, cueDiv);\n\n  while (text = nextTextNode(nodeStack)) {\n    for (var i = 0; i < text.length; i++) {\n      charCode = text.charCodeAt(i);\n\n      if (isStrongRTLChar(charCode)) {\n        return \"rtl\";\n      }\n    }\n  }\n\n  return \"ltr\";\n}\n\nfunction computeLinePos(cue) {\n  if (typeof cue.line === \"number\" && (cue.snapToLines || cue.line >= 0 && cue.line <= 100)) {\n    return cue.line;\n  }\n\n  if (!cue.track || !cue.track.textTrackList || !cue.track.textTrackList.mediaElement) {\n    return -1;\n  }\n\n  var track = cue.track,\n      trackList = track.textTrackList,\n      count = 0;\n\n  for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\n    if (trackList[i].mode === \"showing\") {\n      count++;\n    }\n  }\n\n  return ++count * -1;\n}\n\nfunction StyleBox() {} // Apply styles to a div. If there is no div passed then it defaults to the\n// div on 'this'.\n\n\nStyleBox.prototype.applyStyles = function (styles, div) {\n  div = div || this.div;\n\n  for (var prop in styles) {\n    if (styles.hasOwnProperty(prop)) {\n      div.style[prop] = styles[prop];\n    }\n  }\n};\n\nStyleBox.prototype.formatStyle = function (val, unit) {\n  return val === 0 ? 0 : val + unit;\n}; // Constructs the computed display state of the cue (a div). Places the div\n// into the overlay which should be a block level element (usually a div).\n\n\nfunction CueStyleBox(window, cue, styleOptions) {\n  StyleBox.call(this);\n  this.cue = cue; // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\n  // have inline positioning and will function as the cue background box.\n\n  this.cueDiv = parseContent(window, cue.text);\n  var styles = {\n    color: \"rgba(255, 255, 255, 1)\",\n    backgroundColor: \"rgba(0, 0, 0, 0.8)\",\n    position: \"relative\",\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: \"inline\",\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\" : cue.vertical === \"lr\" ? \"vertical-lr\" : \"vertical-rl\",\n    unicodeBidi: \"plaintext\"\n  };\n  this.applyStyles(styles, this.cueDiv); // Create an absolutely positioned div that will be used to position the cue\n  // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\n  // mirrors of them except middle instead of center on Safari.\n\n  this.div = window.document.createElement(\"div\");\n  styles = {\n    direction: determineBidi(this.cueDiv),\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\" : cue.vertical === \"lr\" ? \"vertical-lr\" : \"vertical-rl\",\n    unicodeBidi: \"plaintext\",\n    textAlign: cue.align === \"middle\" ? \"center\" : cue.align,\n    font: styleOptions.font,\n    whiteSpace: \"pre-line\",\n    position: \"absolute\"\n  };\n  this.applyStyles(styles);\n  this.div.appendChild(this.cueDiv); // Calculate the distance from the reference edge of the viewport to the text\n  // position of the cue box. The reference edge will be resolved later when\n  // the box orientation styles are applied.\n\n  var textPos = 0;\n\n  switch (cue.positionAlign) {\n    case \"start\":\n      textPos = cue.position;\n      break;\n\n    case \"center\":\n      textPos = cue.position - cue.size / 2;\n      break;\n\n    case \"end\":\n      textPos = cue.position - cue.size;\n      break;\n  } // Horizontal box orientation; textPos is the distance from the left edge of the\n  // area to the left edge of the box and cue.size is the distance extending to\n  // the right from there.\n\n\n  if (cue.vertical === \"\") {\n    this.applyStyles({\n      left: this.formatStyle(textPos, \"%\"),\n      width: this.formatStyle(cue.size, \"%\")\n    }); // Vertical box orientation; textPos is the distance from the top edge of the\n    // area to the top edge of the box and cue.size is the height extending\n    // downwards from there.\n  } else {\n    this.applyStyles({\n      top: this.formatStyle(textPos, \"%\"),\n      height: this.formatStyle(cue.size, \"%\")\n    });\n  }\n\n  this.move = function (box) {\n    this.applyStyles({\n      top: this.formatStyle(box.top, \"px\"),\n      bottom: this.formatStyle(box.bottom, \"px\"),\n      left: this.formatStyle(box.left, \"px\"),\n      right: this.formatStyle(box.right, \"px\"),\n      height: this.formatStyle(box.height, \"px\"),\n      width: this.formatStyle(box.width, \"px\")\n    });\n  };\n}\n\nCueStyleBox.prototype = _objCreate(StyleBox.prototype);\nCueStyleBox.prototype.constructor = CueStyleBox; // Represents the co-ordinates of an Element in a way that we can easily\n// compute things with such as if it overlaps or intersects with another Element.\n// Can initialize it with either a StyleBox or another BoxPosition.\n\nfunction BoxPosition(obj) {\n  // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\n  // was passed in and we need to copy the results of 'getBoundingClientRect'\n  // as the object returned is readonly. All co-ordinate values are in reference\n  // to the viewport origin (top left).\n  var lh, height, width, top;\n\n  if (obj.div) {\n    height = obj.div.offsetHeight;\n    width = obj.div.offsetWidth;\n    top = obj.div.offsetTop;\n    var rects = (rects = obj.div.childNodes) && (rects = rects[0]) && rects.getClientRects && rects.getClientRects();\n    obj = obj.div.getBoundingClientRect(); // In certain cases the outter div will be slightly larger then the sum of\n    // the inner div's lines. This could be due to bold text, etc, on some platforms.\n    // In this case we should get the average line height and use that. This will\n    // result in the desired behaviour.\n\n    lh = rects ? Math.max(rects[0] && rects[0].height || 0, obj.height / rects.length) : 0;\n  }\n\n  this.left = obj.left;\n  this.right = obj.right;\n  this.top = obj.top || top;\n  this.height = obj.height || height;\n  this.bottom = obj.bottom || top + (obj.height || height);\n  this.width = obj.width || width;\n  this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\n} // Move the box along a particular axis. Optionally pass in an amount to move\n// the box. If no amount is passed then the default is the line height of the\n// box.\n\n\nBoxPosition.prototype.move = function (axis, toMove) {\n  toMove = toMove !== undefined ? toMove : this.lineHeight;\n\n  switch (axis) {\n    case \"+x\":\n      this.left += toMove;\n      this.right += toMove;\n      break;\n\n    case \"-x\":\n      this.left -= toMove;\n      this.right -= toMove;\n      break;\n\n    case \"+y\":\n      this.top += toMove;\n      this.bottom += toMove;\n      break;\n\n    case \"-y\":\n      this.top -= toMove;\n      this.bottom -= toMove;\n      break;\n  }\n}; // Check if this box overlaps another box, b2.\n\n\nBoxPosition.prototype.overlaps = function (b2) {\n  return this.left < b2.right && this.right > b2.left && this.top < b2.bottom && this.bottom > b2.top;\n}; // Check if this box overlaps any other boxes in boxes.\n\n\nBoxPosition.prototype.overlapsAny = function (boxes) {\n  for (var i = 0; i < boxes.length; i++) {\n    if (this.overlaps(boxes[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}; // Check if this box is within another box.\n\n\nBoxPosition.prototype.within = function (container) {\n  return this.top >= container.top && this.bottom <= container.bottom && this.left >= container.left && this.right <= container.right;\n}; // Check if this box is entirely within the container or it is overlapping\n// on the edge opposite of the axis direction passed. For example, if \"+x\" is\n// passed and the box is overlapping on the left edge of the container, then\n// return true.\n\n\nBoxPosition.prototype.overlapsOppositeAxis = function (container, axis) {\n  switch (axis) {\n    case \"+x\":\n      return this.left < container.left;\n\n    case \"-x\":\n      return this.right > container.right;\n\n    case \"+y\":\n      return this.top < container.top;\n\n    case \"-y\":\n      return this.bottom > container.bottom;\n  }\n}; // Find the percentage of the area that this box is overlapping with another\n// box.\n\n\nBoxPosition.prototype.intersectPercentage = function (b2) {\n  var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left)),\n      y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top)),\n      intersectArea = x * y;\n  return intersectArea / (this.height * this.width);\n}; // Convert the positions from this box to CSS compatible positions using\n// the reference container's positions. This has to be done because this\n// box's positions are in reference to the viewport origin, whereas, CSS\n// values are in referecne to their respective edges.\n\n\nBoxPosition.prototype.toCSSCompatValues = function (reference) {\n  return {\n    top: this.top - reference.top,\n    bottom: reference.bottom - this.bottom,\n    left: this.left - reference.left,\n    right: reference.right - this.right,\n    height: this.height,\n    width: this.width\n  };\n}; // Get an object that represents the box's position without anything extra.\n// Can pass a StyleBox, HTMLElement, or another BoxPositon.\n\n\nBoxPosition.getSimpleBoxPosition = function (obj) {\n  var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\n  var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\n  var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\n  obj = obj.div ? obj.div.getBoundingClientRect() : obj.tagName ? obj.getBoundingClientRect() : obj;\n  var ret = {\n    left: obj.left,\n    right: obj.right,\n    top: obj.top || top,\n    height: obj.height || height,\n    bottom: obj.bottom || top + (obj.height || height),\n    width: obj.width || width\n  };\n  return ret;\n}; // Move a StyleBox to its specified, or next best, position. The containerBox\n// is the box that contains the StyleBox, such as a div. boxPositions are\n// a list of other boxes that the styleBox can't overlap with.\n\n\nfunction moveBoxToLinePosition(window, styleBox, containerBox, boxPositions) {\n  // Find the best position for a cue box, b, on the video. The axis parameter\n  // is a list of axis, the order of which, it will move the box along. For example:\n  // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\n  // direction. If it doesn't find a good position for it there it will then move\n  // it along the x axis in the negative direction.\n  function findBestPosition(b, axis) {\n    var bestPosition,\n        specifiedPosition = new BoxPosition(b),\n        percentage = 1; // Highest possible so the first thing we get is better.\n\n    for (var i = 0; i < axis.length; i++) {\n      while (b.overlapsOppositeAxis(containerBox, axis[i]) || b.within(containerBox) && b.overlapsAny(boxPositions)) {\n        b.move(axis[i]);\n      } // We found a spot where we aren't overlapping anything. This is our\n      // best position.\n\n\n      if (b.within(containerBox)) {\n        return b;\n      }\n\n      var p = b.intersectPercentage(containerBox); // If we're outside the container box less then we were on our last try\n      // then remember this position as the best position.\n\n      if (percentage > p) {\n        bestPosition = new BoxPosition(b);\n        percentage = p;\n      } // Reset the box position to the specified position.\n\n\n      b = new BoxPosition(specifiedPosition);\n    }\n\n    return bestPosition || specifiedPosition;\n  }\n\n  var boxPosition = new BoxPosition(styleBox),\n      cue = styleBox.cue,\n      linePos = computeLinePos(cue),\n      axis = []; // If we have a line number to align the cue to.\n\n  if (cue.snapToLines) {\n    var size;\n\n    switch (cue.vertical) {\n      case \"\":\n        axis = [\"+y\", \"-y\"];\n        size = \"height\";\n        break;\n\n      case \"rl\":\n        axis = [\"+x\", \"-x\"];\n        size = \"width\";\n        break;\n\n      case \"lr\":\n        axis = [\"-x\", \"+x\"];\n        size = \"width\";\n        break;\n    }\n\n    var step = boxPosition.lineHeight,\n        position = step * Math.round(linePos),\n        maxPosition = containerBox[size] + step,\n        initialAxis = axis[0]; // If the specified intial position is greater then the max position then\n    // clamp the box to the amount of steps it would take for the box to\n    // reach the max position.\n\n    if (Math.abs(position) > maxPosition) {\n      position = position < 0 ? -1 : 1;\n      position *= Math.ceil(maxPosition / step) * step;\n    } // If computed line position returns negative then line numbers are\n    // relative to the bottom of the video instead of the top. Therefore, we\n    // need to increase our initial position by the length or width of the\n    // video, depending on the writing direction, and reverse our axis directions.\n\n\n    if (linePos < 0) {\n      position += cue.vertical === \"\" ? containerBox.height : containerBox.width;\n      axis = axis.reverse();\n    } // Move the box to the specified position. This may not be its best\n    // position.\n\n\n    boxPosition.move(initialAxis, position);\n  } else {\n    // If we have a percentage line value for the cue.\n    var calculatedPercentage = boxPosition.lineHeight / containerBox.height * 100;\n\n    switch (cue.lineAlign) {\n      case \"center\":\n        linePos -= calculatedPercentage / 2;\n        break;\n\n      case \"end\":\n        linePos -= calculatedPercentage;\n        break;\n    } // Apply initial line position to the cue box.\n\n\n    switch (cue.vertical) {\n      case \"\":\n        styleBox.applyStyles({\n          top: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n\n      case \"rl\":\n        styleBox.applyStyles({\n          left: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n\n      case \"lr\":\n        styleBox.applyStyles({\n          right: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n    }\n\n    axis = [\"+y\", \"-x\", \"+x\", \"-y\"]; // Get the box position again after we've applied the specified positioning\n    // to it.\n\n    boxPosition = new BoxPosition(styleBox);\n  }\n\n  var bestPosition = findBestPosition(boxPosition, axis);\n  styleBox.move(bestPosition.toCSSCompatValues(containerBox));\n}\n\nfunction WebVTT() {// Nothing\n} // Helper to allow strings to be decoded instead of the default binary utf8 data.\n\n\nWebVTT.StringDecoder = function () {\n  return {\n    decode: function (data) {\n      if (!data) {\n        return \"\";\n      }\n\n      if (typeof data !== \"string\") {\n        throw new Error(\"Error - expected string data.\");\n      }\n\n      return decodeURIComponent(encodeURIComponent(data));\n    }\n  };\n};\n\nWebVTT.convertCueToDOMTree = function (window, cuetext) {\n  if (!window || !cuetext) {\n    return null;\n  }\n\n  return parseContent(window, cuetext);\n};\n\nvar FONT_SIZE_PERCENT = 0.05;\nvar FONT_STYLE = \"sans-serif\";\nvar CUE_BACKGROUND_PADDING = \"1.5%\"; // Runs the processing model over the cues and regions passed to it.\n// @param overlay A block level element (usually a div) that the computed cues\n//                and regions will be placed into.\n\nWebVTT.processCues = function (window, cues, overlay) {\n  if (!window || !cues || !overlay) {\n    return null;\n  } // Remove all previous children.\n\n\n  while (overlay.firstChild) {\n    overlay.removeChild(overlay.firstChild);\n  }\n\n  var paddedOverlay = window.document.createElement(\"div\");\n  paddedOverlay.style.position = \"absolute\";\n  paddedOverlay.style.left = \"0\";\n  paddedOverlay.style.right = \"0\";\n  paddedOverlay.style.top = \"0\";\n  paddedOverlay.style.bottom = \"0\";\n  paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\n  overlay.appendChild(paddedOverlay); // Determine if we need to compute the display states of the cues. This could\n  // be the case if a cue's state has been changed since the last computation or\n  // if it has not been computed yet.\n\n  function shouldCompute(cues) {\n    for (var i = 0; i < cues.length; i++) {\n      if (cues[i].hasBeenReset || !cues[i].displayState) {\n        return true;\n      }\n    }\n\n    return false;\n  } // We don't need to recompute the cues' display states. Just reuse them.\n\n\n  if (!shouldCompute(cues)) {\n    for (var i = 0; i < cues.length; i++) {\n      paddedOverlay.appendChild(cues[i].displayState);\n    }\n\n    return;\n  }\n\n  var boxPositions = [],\n      containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay),\n      fontSize = Math.round(containerBox.height * FONT_SIZE_PERCENT * 100) / 100;\n  var styleOptions = {\n    font: fontSize + \"px \" + FONT_STYLE\n  };\n\n  (function () {\n    var styleBox, cue;\n\n    for (var i = 0; i < cues.length; i++) {\n      cue = cues[i]; // Compute the intial position and styles of the cue div.\n\n      styleBox = new CueStyleBox(window, cue, styleOptions);\n      paddedOverlay.appendChild(styleBox.div); // Move the cue div to it's correct line position.\n\n      moveBoxToLinePosition(window, styleBox, containerBox, boxPositions); // Remember the computed div so that we don't have to recompute it later\n      // if we don't have too.\n\n      cue.displayState = styleBox.div;\n      boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\n    }\n  })();\n};\n\nWebVTT.Parser = function (window, vttjs, decoder) {\n  if (!decoder) {\n    decoder = vttjs;\n    vttjs = {};\n  }\n\n  if (!vttjs) {\n    vttjs = {};\n  }\n\n  this.window = window;\n  this.vttjs = vttjs;\n  this.state = \"INITIAL\";\n  this.buffer = \"\";\n  this.decoder = decoder || new TextDecoder(\"utf8\");\n  this.regionList = [];\n};\n\nWebVTT.Parser.prototype = {\n  // If the error is a ParsingError then report it to the consumer if\n  // possible. If it's not a ParsingError then throw it like normal.\n  reportOrThrowError: function (e) {\n    if (e instanceof ParsingError) {\n      this.onparsingerror && this.onparsingerror(e);\n    } else {\n      throw e;\n    }\n  },\n  parse: function (data) {\n    var self = this; // If there is no data then we won't decode it, but will just try to parse\n    // whatever is in buffer already. This may occur in circumstances, for\n    // example when flush() is called.\n\n    if (data) {\n      // Try to decode the data that we received.\n      self.buffer += self.decoder.decode(data, {\n        stream: true\n      });\n    }\n\n    function collectNextLine() {\n      var buffer = self.buffer;\n      var pos = 0;\n\n      while (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\n        ++pos;\n      }\n\n      var line = buffer.substr(0, pos); // Advance the buffer early in case we fail below.\n\n      if (buffer[pos] === '\\r') {\n        ++pos;\n      }\n\n      if (buffer[pos] === '\\n') {\n        ++pos;\n      }\n\n      self.buffer = buffer.substr(pos);\n      return line;\n    } // 3.4 WebVTT region and WebVTT region settings syntax\n\n\n    function parseRegion(input) {\n      var settings = new Settings();\n      parseOptions(input, function (k, v) {\n        switch (k) {\n          case \"id\":\n            settings.set(k, v);\n            break;\n\n          case \"width\":\n            settings.percent(k, v);\n            break;\n\n          case \"lines\":\n            settings.integer(k, v);\n            break;\n\n          case \"regionanchor\":\n          case \"viewportanchor\":\n            var xy = v.split(',');\n\n            if (xy.length !== 2) {\n              break;\n            } // We have to make sure both x and y parse, so use a temporary\n            // settings object here.\n\n\n            var anchor = new Settings();\n            anchor.percent(\"x\", xy[0]);\n            anchor.percent(\"y\", xy[1]);\n\n            if (!anchor.has(\"x\") || !anchor.has(\"y\")) {\n              break;\n            }\n\n            settings.set(k + \"X\", anchor.get(\"x\"));\n            settings.set(k + \"Y\", anchor.get(\"y\"));\n            break;\n\n          case \"scroll\":\n            settings.alt(k, v, [\"up\"]);\n            break;\n        }\n      }, /=/, /\\s/); // Create the region, using default values for any values that were not\n      // specified.\n\n      if (settings.has(\"id\")) {\n        var region = new (self.vttjs.VTTRegion || self.window.VTTRegion)();\n        region.width = settings.get(\"width\", 100);\n        region.lines = settings.get(\"lines\", 3);\n        region.regionAnchorX = settings.get(\"regionanchorX\", 0);\n        region.regionAnchorY = settings.get(\"regionanchorY\", 100);\n        region.viewportAnchorX = settings.get(\"viewportanchorX\", 0);\n        region.viewportAnchorY = settings.get(\"viewportanchorY\", 100);\n        region.scroll = settings.get(\"scroll\", \"\"); // Register the region.\n\n        self.onregion && self.onregion(region); // Remember the VTTRegion for later in case we parse any VTTCues that\n        // reference it.\n\n        self.regionList.push({\n          id: settings.get(\"id\"),\n          region: region\n        });\n      }\n    } // draft-pantos-http-live-streaming-20\n    // https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-3.5\n    // 3.5 WebVTT\n\n\n    function parseTimestampMap(input) {\n      var settings = new Settings();\n      parseOptions(input, function (k, v) {\n        switch (k) {\n          case \"MPEGT\":\n            settings.integer(k + 'S', v);\n            break;\n\n          case \"LOCA\":\n            settings.set(k + 'L', parseTimeStamp(v));\n            break;\n        }\n      }, /[^\\d]:/, /,/);\n      self.ontimestampmap && self.ontimestampmap({\n        \"MPEGTS\": settings.get(\"MPEGTS\"),\n        \"LOCAL\": settings.get(\"LOCAL\")\n      });\n    } // 3.2 WebVTT metadata header syntax\n\n\n    function parseHeader(input) {\n      if (input.match(/X-TIMESTAMP-MAP/)) {\n        // This line contains HLS X-TIMESTAMP-MAP metadata\n        parseOptions(input, function (k, v) {\n          switch (k) {\n            case \"X-TIMESTAMP-MAP\":\n              parseTimestampMap(v);\n              break;\n          }\n        }, /=/);\n      } else {\n        parseOptions(input, function (k, v) {\n          switch (k) {\n            case \"Region\":\n              // 3.3 WebVTT region metadata header syntax\n              parseRegion(v);\n              break;\n          }\n        }, /:/);\n      }\n    } // 5.1 WebVTT file parsing.\n\n\n    try {\n      var line;\n\n      if (self.state === \"INITIAL\") {\n        // We can't start parsing until we have the first line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        line = collectNextLine();\n        var m = line.match(/^WEBVTT([ \\t].*)?$/);\n\n        if (!m || !m[0]) {\n          throw new ParsingError(ParsingError.Errors.BadSignature);\n        }\n\n        self.state = \"HEADER\";\n      }\n\n      var alreadyCollectedLine = false;\n\n      while (self.buffer) {\n        // We can't parse a line until we have the full line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        if (!alreadyCollectedLine) {\n          line = collectNextLine();\n        } else {\n          alreadyCollectedLine = false;\n        }\n\n        switch (self.state) {\n          case \"HEADER\":\n            // 13-18 - Allow a header (metadata) under the WEBVTT line.\n            if (/:/.test(line)) {\n              parseHeader(line);\n            } else if (!line) {\n              // An empty line terminates the header and starts the body (cues).\n              self.state = \"ID\";\n            }\n\n            continue;\n\n          case \"NOTE\":\n            // Ignore NOTE blocks.\n            if (!line) {\n              self.state = \"ID\";\n            }\n\n            continue;\n\n          case \"ID\":\n            // Check for the start of NOTE blocks.\n            if (/^NOTE($|[ \\t])/.test(line)) {\n              self.state = \"NOTE\";\n              break;\n            } // 19-29 - Allow any number of line terminators, then initialize new cue values.\n\n\n            if (!line) {\n              continue;\n            }\n\n            self.cue = new (self.vttjs.VTTCue || self.window.VTTCue)(0, 0, \"\"); // Safari still uses the old middle value and won't accept center\n\n            try {\n              self.cue.align = \"center\";\n            } catch (e) {\n              self.cue.align = \"middle\";\n            }\n\n            self.state = \"CUE\"; // 30-39 - Check if self line contains an optional identifier or timing data.\n\n            if (line.indexOf(\"-->\") === -1) {\n              self.cue.id = line;\n              continue;\n            }\n\n          // Process line as start of a cue.\n\n          /*falls through*/\n\n          case \"CUE\":\n            // 40 - Collect cue timings and settings.\n            try {\n              parseCue(line, self.cue, self.regionList);\n            } catch (e) {\n              self.reportOrThrowError(e); // In case of an error ignore rest of the cue.\n\n              self.cue = null;\n              self.state = \"BADCUE\";\n              continue;\n            }\n\n            self.state = \"CUETEXT\";\n            continue;\n\n          case \"CUETEXT\":\n            var hasSubstring = line.indexOf(\"-->\") !== -1; // 34 - If we have an empty line then report the cue.\n            // 35 - If we have the special substring '-->' then report the cue,\n            // but do not collect the line as we need to process the current\n            // one as a new cue.\n\n            if (!line || hasSubstring && (alreadyCollectedLine = true)) {\n              // We are done parsing self cue.\n              self.oncue && self.oncue(self.cue);\n              self.cue = null;\n              self.state = \"ID\";\n              continue;\n            }\n\n            if (self.cue.text) {\n              self.cue.text += \"\\n\";\n            }\n\n            self.cue.text += line.replace(/\\u2028/g, '\\n').replace(/u2029/g, '\\n');\n            continue;\n\n          case \"BADCUE\":\n            // BADCUE\n            // 54-62 - Collect and discard the remaining cue.\n            if (!line) {\n              self.state = \"ID\";\n            }\n\n            continue;\n        }\n      }\n    } catch (e) {\n      self.reportOrThrowError(e); // If we are currently parsing a cue, report what we have.\n\n      if (self.state === \"CUETEXT\" && self.cue && self.oncue) {\n        self.oncue(self.cue);\n      }\n\n      self.cue = null; // Enter BADWEBVTT state if header was not parsed correctly otherwise\n      // another exception occurred so enter BADCUE state.\n\n      self.state = self.state === \"INITIAL\" ? \"BADWEBVTT\" : \"BADCUE\";\n    }\n\n    return this;\n  },\n  flush: function () {\n    var self = this;\n\n    try {\n      // Finish decoding the stream.\n      self.buffer += self.decoder.decode(); // Synthesize the end of the current cue or region.\n\n      if (self.cue || self.state === \"HEADER\") {\n        self.buffer += \"\\n\\n\";\n        self.parse();\n      } // If we've flushed, parsed, and we're still on the INITIAL state then\n      // that means we don't have enough of the stream to parse the first\n      // line.\n\n\n      if (self.state === \"INITIAL\") {\n        throw new ParsingError(ParsingError.Errors.BadSignature);\n      }\n    } catch (e) {\n      self.reportOrThrowError(e);\n    }\n\n    self.onflush && self.onflush();\n    return this;\n  }\n};\nmodule.exports = WebVTT;","map":{"version":3,"sources":["/Users/cj/Desktop/andromeda_swap_fork/pancake-swap-interface-v1/node_modules/videojs-vtt.js/lib/vtt.js"],"names":["document","require","_objCreate","Object","create","F","o","arguments","length","Error","prototype","ParsingError","errorData","message","name","code","constructor","Errors","BadSignature","BadTimeStamp","parseTimeStamp","input","computeSeconds","h","m","s","f","match","replace","Settings","values","set","k","v","get","dflt","defaultKey","has","alt","a","n","integer","test","parseInt","percent","parseFloat","parseOptions","callback","keyValueDelim","groupDelim","groups","split","i","kv","parseCue","cue","regionList","oInput","consumeTimeStamp","ts","consumeCueSettings","settings","id","region","vals","vals0","vertical","line","e","lineAlign","snapToLines","size","align","position","start","left","center","middle","end","right","positionAlign","skipWhitespace","startTime","substr","endTime","TEXTAREA_ELEMENT","createElement","TAG_NAME","c","b","u","ruby","rt","lang","DEFAULT_COLOR_CLASS","white","lime","cyan","red","yellow","magenta","blue","black","TAG_ANNOTATION","NEEDS_PARENT","parseContent","window","nextToken","consume","result","unescape","innerHTML","textContent","shouldAdd","current","element","localName","type","annotation","tagName","trim","rootDiv","t","tagStack","pop","parentNode","node","createProcessingInstruction","appendChild","classes","forEach","cl","bgColor","colorName","slice","hasOwnProperty","propName","propValue","style","className","join","push","createTextNode","strongRTLRanges","isStrongRTLChar","charCode","currentRange","determineBidi","cueDiv","nodeStack","text","childNodes","pushNodes","nextTextNode","innerText","charCodeAt","computeLinePos","track","textTrackList","mediaElement","trackList","count","mode","StyleBox","applyStyles","styles","div","prop","formatStyle","val","unit","CueStyleBox","styleOptions","call","color","backgroundColor","top","bottom","display","writingMode","unicodeBidi","direction","textAlign","font","whiteSpace","textPos","width","height","move","box","BoxPosition","obj","lh","offsetHeight","offsetWidth","offsetTop","rects","getClientRects","getBoundingClientRect","Math","max","lineHeight","undefined","axis","toMove","overlaps","b2","overlapsAny","boxes","within","container","overlapsOppositeAxis","intersectPercentage","x","min","y","intersectArea","toCSSCompatValues","reference","getSimpleBoxPosition","ret","moveBoxToLinePosition","styleBox","containerBox","boxPositions","findBestPosition","bestPosition","specifiedPosition","percentage","p","boxPosition","linePos","step","round","maxPosition","initialAxis","abs","ceil","reverse","calculatedPercentage","WebVTT","StringDecoder","decode","data","decodeURIComponent","encodeURIComponent","convertCueToDOMTree","cuetext","FONT_SIZE_PERCENT","FONT_STYLE","CUE_BACKGROUND_PADDING","processCues","cues","overlay","firstChild","removeChild","paddedOverlay","margin","shouldCompute","hasBeenReset","displayState","fontSize","Parser","vttjs","decoder","state","buffer","TextDecoder","reportOrThrowError","onparsingerror","parse","self","stream","collectNextLine","pos","parseRegion","xy","anchor","VTTRegion","lines","regionAnchorX","regionAnchorY","viewportAnchorX","viewportAnchorY","scroll","onregion","parseTimestampMap","ontimestampmap","parseHeader","alreadyCollectedLine","VTTCue","indexOf","hasSubstring","oncue","flush","onflush","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright 2013 vtt.js Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\nvar document = require('global/document');\n\nvar _objCreate = Object.create || (function() {\n  function F() {}\n  return function(o) {\n    if (arguments.length !== 1) {\n      throw new Error('Object.create shim only accepts one parameter.');\n    }\n    F.prototype = o;\n    return new F();\n  };\n})();\n\n// Creates a new ParserError object from an errorData object. The errorData\n// object should have default code and message properties. The default message\n// property can be overriden by passing in a message parameter.\n// See ParsingError.Errors below for acceptable errors.\nfunction ParsingError(errorData, message) {\n  this.name = \"ParsingError\";\n  this.code = errorData.code;\n  this.message = message || errorData.message;\n}\nParsingError.prototype = _objCreate(Error.prototype);\nParsingError.prototype.constructor = ParsingError;\n\n// ParsingError metadata for acceptable ParsingErrors.\nParsingError.Errors = {\n  BadSignature: {\n    code: 0,\n    message: \"Malformed WebVTT signature.\"\n  },\n  BadTimeStamp: {\n    code: 1,\n    message: \"Malformed time stamp.\"\n  }\n};\n\n// Try to parse input as a time stamp.\nfunction parseTimeStamp(input) {\n\n  function computeSeconds(h, m, s, f) {\n    return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\n  }\n\n  var m = input.match(/^(\\d+):(\\d{1,2})(:\\d{1,2})?\\.(\\d{3})/);\n  if (!m) {\n    return null;\n  }\n\n  if (m[3]) {\n    // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\n    return computeSeconds(m[1], m[2], m[3].replace(\":\", \"\"), m[4]);\n  } else if (m[1] > 59) {\n    // Timestamp takes the form of [hours]:[minutes].[milliseconds]\n    // First position is hours as it's over 59.\n    return computeSeconds(m[1], m[2], 0,  m[4]);\n  } else {\n    // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\n    return computeSeconds(0, m[1], m[2], m[4]);\n  }\n}\n\n// A settings object holds key/value pairs and will ignore anything but the first\n// assignment to a specific key.\nfunction Settings() {\n  this.values = _objCreate(null);\n}\n\nSettings.prototype = {\n  // Only accept the first assignment to any key.\n  set: function(k, v) {\n    if (!this.get(k) && v !== \"\") {\n      this.values[k] = v;\n    }\n  },\n  // Return the value for a key, or a default value.\n  // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\n  // a number of possible default values as properties where 'defaultKey' is\n  // the key of the property that will be chosen; otherwise it's assumed to be\n  // a single value.\n  get: function(k, dflt, defaultKey) {\n    if (defaultKey) {\n      return this.has(k) ? this.values[k] : dflt[defaultKey];\n    }\n    return this.has(k) ? this.values[k] : dflt;\n  },\n  // Check whether we have a value for a key.\n  has: function(k) {\n    return k in this.values;\n  },\n  // Accept a setting if its one of the given alternatives.\n  alt: function(k, v, a) {\n    for (var n = 0; n < a.length; ++n) {\n      if (v === a[n]) {\n        this.set(k, v);\n        break;\n      }\n    }\n  },\n  // Accept a setting if its a valid (signed) integer.\n  integer: function(k, v) {\n    if (/^-?\\d+$/.test(v)) { // integer\n      this.set(k, parseInt(v, 10));\n    }\n  },\n  // Accept a setting if its a valid percentage.\n  percent: function(k, v) {\n    var m;\n    if ((m = v.match(/^([\\d]{1,3})(\\.[\\d]*)?%$/))) {\n      v = parseFloat(v);\n      if (v >= 0 && v <= 100) {\n        this.set(k, v);\n        return true;\n      }\n    }\n    return false;\n  }\n};\n\n// Helper function to parse input into groups separated by 'groupDelim', and\n// interprete each group as a key/value pair separated by 'keyValueDelim'.\nfunction parseOptions(input, callback, keyValueDelim, groupDelim) {\n  var groups = groupDelim ? input.split(groupDelim) : [input];\n  for (var i in groups) {\n    if (typeof groups[i] !== \"string\") {\n      continue;\n    }\n    var kv = groups[i].split(keyValueDelim);\n    if (kv.length !== 2) {\n      continue;\n    }\n    var k = kv[0];\n    var v = kv[1];\n    callback(k, v);\n  }\n}\n\nfunction parseCue(input, cue, regionList) {\n  // Remember the original input if we need to throw an error.\n  var oInput = input;\n  // 4.1 WebVTT timestamp\n  function consumeTimeStamp() {\n    var ts = parseTimeStamp(input);\n    if (ts === null) {\n      throw new ParsingError(ParsingError.Errors.BadTimeStamp,\n                            \"Malformed timestamp: \" + oInput);\n    }\n    // Remove time stamp from input.\n    input = input.replace(/^[^\\sa-zA-Z-]+/, \"\");\n    return ts;\n  }\n\n  // 4.4.2 WebVTT cue settings\n  function consumeCueSettings(input, cue) {\n    var settings = new Settings();\n\n    parseOptions(input, function (k, v) {\n      switch (k) {\n      case \"region\":\n        // Find the last region we parsed with the same region id.\n        for (var i = regionList.length - 1; i >= 0; i--) {\n          if (regionList[i].id === v) {\n            settings.set(k, regionList[i].region);\n            break;\n          }\n        }\n        break;\n      case \"vertical\":\n        settings.alt(k, v, [\"rl\", \"lr\"]);\n        break;\n      case \"line\":\n        var vals = v.split(\",\"),\n            vals0 = vals[0];\n        settings.integer(k, vals0);\n        settings.percent(k, vals0) ? settings.set(\"snapToLines\", false) : null;\n        settings.alt(k, vals0, [\"auto\"]);\n        if (vals.length === 2) {\n          settings.alt(\"lineAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n        }\n        break;\n      case \"position\":\n        vals = v.split(\",\");\n        settings.percent(k, vals[0]);\n        if (vals.length === 2) {\n          settings.alt(\"positionAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n        }\n        break;\n      case \"size\":\n        settings.percent(k, v);\n        break;\n      case \"align\":\n        settings.alt(k, v, [\"start\", \"center\", \"end\", \"left\", \"right\"]);\n        break;\n      }\n    }, /:/, /\\s/);\n\n    // Apply default values for any missing fields.\n    cue.region = settings.get(\"region\", null);\n    cue.vertical = settings.get(\"vertical\", \"\");\n    try {\n      cue.line = settings.get(\"line\", \"auto\");\n    } catch (e) {}\n    cue.lineAlign = settings.get(\"lineAlign\", \"start\");\n    cue.snapToLines = settings.get(\"snapToLines\", true);\n    cue.size = settings.get(\"size\", 100);\n    // Safari still uses the old middle value and won't accept center\n    try {\n      cue.align = settings.get(\"align\", \"center\");\n    } catch (e) {\n      cue.align = settings.get(\"align\", \"middle\");\n    }\n    try {\n      cue.position = settings.get(\"position\", \"auto\");\n    } catch (e) {\n      cue.position = settings.get(\"position\", {\n        start: 0,\n        left: 0,\n        center: 50,\n        middle: 50,\n        end: 100,\n        right: 100\n      }, cue.align);\n    }\n\n\n    cue.positionAlign = settings.get(\"positionAlign\", {\n      start: \"start\",\n      left: \"start\",\n      center: \"center\",\n      middle: \"center\",\n      end: \"end\",\n      right: \"end\"\n    }, cue.align);\n  }\n\n  function skipWhitespace() {\n    input = input.replace(/^\\s+/, \"\");\n  }\n\n  // 4.1 WebVTT cue timings.\n  skipWhitespace();\n  cue.startTime = consumeTimeStamp();   // (1) collect cue start time\n  skipWhitespace();\n  if (input.substr(0, 3) !== \"-->\") {     // (3) next characters must match \"-->\"\n    throw new ParsingError(ParsingError.Errors.BadTimeStamp,\n                           \"Malformed time stamp (time stamps must be separated by '-->'): \" +\n                           oInput);\n  }\n  input = input.substr(3);\n  skipWhitespace();\n  cue.endTime = consumeTimeStamp();     // (5) collect cue end time\n\n  // 4.1 WebVTT cue settings list.\n  skipWhitespace();\n  consumeCueSettings(input, cue);\n}\n\n// When evaluating this file as part of a Webpack bundle for server\n// side rendering, `document` is an empty object.\nvar TEXTAREA_ELEMENT = document.createElement && document.createElement(\"textarea\");\n\nvar TAG_NAME = {\n  c: \"span\",\n  i: \"i\",\n  b: \"b\",\n  u: \"u\",\n  ruby: \"ruby\",\n  rt: \"rt\",\n  v: \"span\",\n  lang: \"span\"\n};\n\n// 5.1 default text color\n// 5.2 default text background color is equivalent to text color with bg_ prefix\nvar DEFAULT_COLOR_CLASS = {\n  white: 'rgba(255,255,255,1)',\n  lime: 'rgba(0,255,0,1)',\n  cyan: 'rgba(0,255,255,1)',\n  red: 'rgba(255,0,0,1)',\n  yellow: 'rgba(255,255,0,1)',\n  magenta: 'rgba(255,0,255,1)',\n  blue: 'rgba(0,0,255,1)',\n  black: 'rgba(0,0,0,1)'\n};\n\nvar TAG_ANNOTATION = {\n  v: \"title\",\n  lang: \"lang\"\n};\n\nvar NEEDS_PARENT = {\n  rt: \"ruby\"\n};\n\n// Parse content into a document fragment.\nfunction parseContent(window, input) {\n  function nextToken() {\n    // Check for end-of-string.\n    if (!input) {\n      return null;\n    }\n\n    // Consume 'n' characters from the input.\n    function consume(result) {\n      input = input.substr(result.length);\n      return result;\n    }\n\n    var m = input.match(/^([^<]*)(<[^>]*>?)?/);\n    // If there is some text before the next tag, return it, otherwise return\n    // the tag.\n    return consume(m[1] ? m[1] : m[2]);\n  }\n\n  function unescape(s) {\n    TEXTAREA_ELEMENT.innerHTML = s;\n    s = TEXTAREA_ELEMENT.textContent;\n    TEXTAREA_ELEMENT.textContent = \"\";\n    return s;\n  }\n\n  function shouldAdd(current, element) {\n    return !NEEDS_PARENT[element.localName] ||\n           NEEDS_PARENT[element.localName] === current.localName;\n  }\n\n  // Create an element for this tag.\n  function createElement(type, annotation) {\n    var tagName = TAG_NAME[type];\n    if (!tagName) {\n      return null;\n    }\n    var element = window.document.createElement(tagName);\n    var name = TAG_ANNOTATION[type];\n    if (name && annotation) {\n      element[name] = annotation.trim();\n    }\n    return element;\n  }\n\n  var rootDiv = window.document.createElement(\"div\"),\n      current = rootDiv,\n      t,\n      tagStack = [];\n\n  while ((t = nextToken()) !== null) {\n    if (t[0] === '<') {\n      if (t[1] === \"/\") {\n        // If the closing tag matches, move back up to the parent node.\n        if (tagStack.length &&\n            tagStack[tagStack.length - 1] === t.substr(2).replace(\">\", \"\")) {\n          tagStack.pop();\n          current = current.parentNode;\n        }\n        // Otherwise just ignore the end tag.\n        continue;\n      }\n      var ts = parseTimeStamp(t.substr(1, t.length - 2));\n      var node;\n      if (ts) {\n        // Timestamps are lead nodes as well.\n        node = window.document.createProcessingInstruction(\"timestamp\", ts);\n        current.appendChild(node);\n        continue;\n      }\n      var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/);\n      // If we can't parse the tag, skip to the next tag.\n      if (!m) {\n        continue;\n      }\n      // Try to construct an element, and ignore the tag if we couldn't.\n      node = createElement(m[1], m[3]);\n      if (!node) {\n        continue;\n      }\n      // Determine if the tag should be added based on the context of where it\n      // is placed in the cuetext.\n      if (!shouldAdd(current, node)) {\n        continue;\n      }\n      // Set the class list (as a list of classes, separated by space).\n      if (m[2]) {\n        var classes = m[2].split('.');\n\n        classes.forEach(function(cl) {\n          var bgColor = /^bg_/.test(cl);\n          // slice out `bg_` if it's a background color\n          var colorName = bgColor ? cl.slice(3) : cl;\n\n          if (DEFAULT_COLOR_CLASS.hasOwnProperty(colorName)) {\n            var propName = bgColor ? 'background-color' : 'color';\n            var propValue = DEFAULT_COLOR_CLASS[colorName];\n\n            node.style[propName] = propValue;\n          }\n        });\n\n        node.className = classes.join(' ');\n      }\n      // Append the node to the current node, and enter the scope of the new\n      // node.\n      tagStack.push(m[1]);\n      current.appendChild(node);\n      current = node;\n      continue;\n    }\n\n    // Text nodes are leaf nodes.\n    current.appendChild(window.document.createTextNode(unescape(t)));\n  }\n\n  return rootDiv;\n}\n\n// This is a list of all the Unicode characters that have a strong\n// right-to-left category. What this means is that these characters are\n// written right-to-left for sure. It was generated by pulling all the strong\n// right-to-left characters out of the Unicode data table. That table can\n// found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\nvar strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6],\n [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d],\n [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6],\n [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5],\n [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815],\n [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858],\n [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f],\n [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c],\n [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1],\n [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc],\n [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808],\n [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855],\n [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f],\n [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13],\n [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58],\n [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72],\n [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f],\n [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32],\n [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42],\n [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f],\n [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59],\n [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62],\n [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77],\n [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b],\n [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\n\nfunction isStrongRTLChar(charCode) {\n  for (var i = 0; i < strongRTLRanges.length; i++) {\n    var currentRange = strongRTLRanges[i];\n    if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction determineBidi(cueDiv) {\n  var nodeStack = [],\n      text = \"\",\n      charCode;\n\n  if (!cueDiv || !cueDiv.childNodes) {\n    return \"ltr\";\n  }\n\n  function pushNodes(nodeStack, node) {\n    for (var i = node.childNodes.length - 1; i >= 0; i--) {\n      nodeStack.push(node.childNodes[i]);\n    }\n  }\n\n  function nextTextNode(nodeStack) {\n    if (!nodeStack || !nodeStack.length) {\n      return null;\n    }\n\n    var node = nodeStack.pop(),\n        text = node.textContent || node.innerText;\n    if (text) {\n      // TODO: This should match all unicode type B characters (paragraph\n      // separator characters). See issue #115.\n      var m = text.match(/^.*(\\n|\\r)/);\n      if (m) {\n        nodeStack.length = 0;\n        return m[0];\n      }\n      return text;\n    }\n    if (node.tagName === \"ruby\") {\n      return nextTextNode(nodeStack);\n    }\n    if (node.childNodes) {\n      pushNodes(nodeStack, node);\n      return nextTextNode(nodeStack);\n    }\n  }\n\n  pushNodes(nodeStack, cueDiv);\n  while ((text = nextTextNode(nodeStack))) {\n    for (var i = 0; i < text.length; i++) {\n      charCode = text.charCodeAt(i);\n      if (isStrongRTLChar(charCode)) {\n        return \"rtl\";\n      }\n    }\n  }\n  return \"ltr\";\n}\n\nfunction computeLinePos(cue) {\n  if (typeof cue.line === \"number\" &&\n      (cue.snapToLines || (cue.line >= 0 && cue.line <= 100))) {\n    return cue.line;\n  }\n  if (!cue.track || !cue.track.textTrackList ||\n      !cue.track.textTrackList.mediaElement) {\n    return -1;\n  }\n  var track = cue.track,\n      trackList = track.textTrackList,\n      count = 0;\n  for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\n    if (trackList[i].mode === \"showing\") {\n      count++;\n    }\n  }\n  return ++count * -1;\n}\n\nfunction StyleBox() {\n}\n\n// Apply styles to a div. If there is no div passed then it defaults to the\n// div on 'this'.\nStyleBox.prototype.applyStyles = function(styles, div) {\n  div = div || this.div;\n  for (var prop in styles) {\n    if (styles.hasOwnProperty(prop)) {\n      div.style[prop] = styles[prop];\n    }\n  }\n};\n\nStyleBox.prototype.formatStyle = function(val, unit) {\n  return val === 0 ? 0 : val + unit;\n};\n\n// Constructs the computed display state of the cue (a div). Places the div\n// into the overlay which should be a block level element (usually a div).\nfunction CueStyleBox(window, cue, styleOptions) {\n  StyleBox.call(this);\n  this.cue = cue;\n\n  // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\n  // have inline positioning and will function as the cue background box.\n  this.cueDiv = parseContent(window, cue.text);\n  var styles = {\n    color: \"rgba(255, 255, 255, 1)\",\n    backgroundColor:  \"rgba(0, 0, 0, 0.8)\",\n    position: \"relative\",\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: \"inline\",\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\"\n                                     : cue.vertical === \"lr\" ? \"vertical-lr\"\n                                                             : \"vertical-rl\",\n    unicodeBidi: \"plaintext\"\n  };\n\n  this.applyStyles(styles, this.cueDiv);\n\n  // Create an absolutely positioned div that will be used to position the cue\n  // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\n  // mirrors of them except middle instead of center on Safari.\n  this.div = window.document.createElement(\"div\");\n  styles = {\n    direction: determineBidi(this.cueDiv),\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\"\n                                     : cue.vertical === \"lr\" ? \"vertical-lr\"\n                                                             : \"vertical-rl\",\n    unicodeBidi: \"plaintext\",\n    textAlign: cue.align === \"middle\" ? \"center\" : cue.align,\n    font: styleOptions.font,\n    whiteSpace: \"pre-line\",\n    position: \"absolute\"\n  };\n\n  this.applyStyles(styles);\n  this.div.appendChild(this.cueDiv);\n\n  // Calculate the distance from the reference edge of the viewport to the text\n  // position of the cue box. The reference edge will be resolved later when\n  // the box orientation styles are applied.\n  var textPos = 0;\n  switch (cue.positionAlign) {\n  case \"start\":\n    textPos = cue.position;\n    break;\n  case \"center\":\n    textPos = cue.position - (cue.size / 2);\n    break;\n  case \"end\":\n    textPos = cue.position - cue.size;\n    break;\n  }\n\n  // Horizontal box orientation; textPos is the distance from the left edge of the\n  // area to the left edge of the box and cue.size is the distance extending to\n  // the right from there.\n  if (cue.vertical === \"\") {\n    this.applyStyles({\n      left:  this.formatStyle(textPos, \"%\"),\n      width: this.formatStyle(cue.size, \"%\")\n    });\n  // Vertical box orientation; textPos is the distance from the top edge of the\n  // area to the top edge of the box and cue.size is the height extending\n  // downwards from there.\n  } else {\n    this.applyStyles({\n      top: this.formatStyle(textPos, \"%\"),\n      height: this.formatStyle(cue.size, \"%\")\n    });\n  }\n\n  this.move = function(box) {\n    this.applyStyles({\n      top: this.formatStyle(box.top, \"px\"),\n      bottom: this.formatStyle(box.bottom, \"px\"),\n      left: this.formatStyle(box.left, \"px\"),\n      right: this.formatStyle(box.right, \"px\"),\n      height: this.formatStyle(box.height, \"px\"),\n      width: this.formatStyle(box.width, \"px\")\n    });\n  };\n}\nCueStyleBox.prototype = _objCreate(StyleBox.prototype);\nCueStyleBox.prototype.constructor = CueStyleBox;\n\n// Represents the co-ordinates of an Element in a way that we can easily\n// compute things with such as if it overlaps or intersects with another Element.\n// Can initialize it with either a StyleBox or another BoxPosition.\nfunction BoxPosition(obj) {\n  // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\n  // was passed in and we need to copy the results of 'getBoundingClientRect'\n  // as the object returned is readonly. All co-ordinate values are in reference\n  // to the viewport origin (top left).\n  var lh, height, width, top;\n  if (obj.div) {\n    height = obj.div.offsetHeight;\n    width = obj.div.offsetWidth;\n    top = obj.div.offsetTop;\n\n    var rects = (rects = obj.div.childNodes) && (rects = rects[0]) &&\n                rects.getClientRects && rects.getClientRects();\n    obj = obj.div.getBoundingClientRect();\n    // In certain cases the outter div will be slightly larger then the sum of\n    // the inner div's lines. This could be due to bold text, etc, on some platforms.\n    // In this case we should get the average line height and use that. This will\n    // result in the desired behaviour.\n    lh = rects ? Math.max((rects[0] && rects[0].height) || 0, obj.height / rects.length)\n               : 0;\n\n  }\n  this.left = obj.left;\n  this.right = obj.right;\n  this.top = obj.top || top;\n  this.height = obj.height || height;\n  this.bottom = obj.bottom || (top + (obj.height || height));\n  this.width = obj.width || width;\n  this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\n}\n\n// Move the box along a particular axis. Optionally pass in an amount to move\n// the box. If no amount is passed then the default is the line height of the\n// box.\nBoxPosition.prototype.move = function(axis, toMove) {\n  toMove = toMove !== undefined ? toMove : this.lineHeight;\n  switch (axis) {\n  case \"+x\":\n    this.left += toMove;\n    this.right += toMove;\n    break;\n  case \"-x\":\n    this.left -= toMove;\n    this.right -= toMove;\n    break;\n  case \"+y\":\n    this.top += toMove;\n    this.bottom += toMove;\n    break;\n  case \"-y\":\n    this.top -= toMove;\n    this.bottom -= toMove;\n    break;\n  }\n};\n\n// Check if this box overlaps another box, b2.\nBoxPosition.prototype.overlaps = function(b2) {\n  return this.left < b2.right &&\n         this.right > b2.left &&\n         this.top < b2.bottom &&\n         this.bottom > b2.top;\n};\n\n// Check if this box overlaps any other boxes in boxes.\nBoxPosition.prototype.overlapsAny = function(boxes) {\n  for (var i = 0; i < boxes.length; i++) {\n    if (this.overlaps(boxes[i])) {\n      return true;\n    }\n  }\n  return false;\n};\n\n// Check if this box is within another box.\nBoxPosition.prototype.within = function(container) {\n  return this.top >= container.top &&\n         this.bottom <= container.bottom &&\n         this.left >= container.left &&\n         this.right <= container.right;\n};\n\n// Check if this box is entirely within the container or it is overlapping\n// on the edge opposite of the axis direction passed. For example, if \"+x\" is\n// passed and the box is overlapping on the left edge of the container, then\n// return true.\nBoxPosition.prototype.overlapsOppositeAxis = function(container, axis) {\n  switch (axis) {\n  case \"+x\":\n    return this.left < container.left;\n  case \"-x\":\n    return this.right > container.right;\n  case \"+y\":\n    return this.top < container.top;\n  case \"-y\":\n    return this.bottom > container.bottom;\n  }\n};\n\n// Find the percentage of the area that this box is overlapping with another\n// box.\nBoxPosition.prototype.intersectPercentage = function(b2) {\n  var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left)),\n      y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top)),\n      intersectArea = x * y;\n  return intersectArea / (this.height * this.width);\n};\n\n// Convert the positions from this box to CSS compatible positions using\n// the reference container's positions. This has to be done because this\n// box's positions are in reference to the viewport origin, whereas, CSS\n// values are in referecne to their respective edges.\nBoxPosition.prototype.toCSSCompatValues = function(reference) {\n  return {\n    top: this.top - reference.top,\n    bottom: reference.bottom - this.bottom,\n    left: this.left - reference.left,\n    right: reference.right - this.right,\n    height: this.height,\n    width: this.width\n  };\n};\n\n// Get an object that represents the box's position without anything extra.\n// Can pass a StyleBox, HTMLElement, or another BoxPositon.\nBoxPosition.getSimpleBoxPosition = function(obj) {\n  var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\n  var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\n  var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\n\n  obj = obj.div ? obj.div.getBoundingClientRect() :\n                obj.tagName ? obj.getBoundingClientRect() : obj;\n  var ret = {\n    left: obj.left,\n    right: obj.right,\n    top: obj.top || top,\n    height: obj.height || height,\n    bottom: obj.bottom || (top + (obj.height || height)),\n    width: obj.width || width\n  };\n  return ret;\n};\n\n// Move a StyleBox to its specified, or next best, position. The containerBox\n// is the box that contains the StyleBox, such as a div. boxPositions are\n// a list of other boxes that the styleBox can't overlap with.\nfunction moveBoxToLinePosition(window, styleBox, containerBox, boxPositions) {\n\n  // Find the best position for a cue box, b, on the video. The axis parameter\n  // is a list of axis, the order of which, it will move the box along. For example:\n  // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\n  // direction. If it doesn't find a good position for it there it will then move\n  // it along the x axis in the negative direction.\n  function findBestPosition(b, axis) {\n    var bestPosition,\n        specifiedPosition = new BoxPosition(b),\n        percentage = 1; // Highest possible so the first thing we get is better.\n\n    for (var i = 0; i < axis.length; i++) {\n      while (b.overlapsOppositeAxis(containerBox, axis[i]) ||\n             (b.within(containerBox) && b.overlapsAny(boxPositions))) {\n        b.move(axis[i]);\n      }\n      // We found a spot where we aren't overlapping anything. This is our\n      // best position.\n      if (b.within(containerBox)) {\n        return b;\n      }\n      var p = b.intersectPercentage(containerBox);\n      // If we're outside the container box less then we were on our last try\n      // then remember this position as the best position.\n      if (percentage > p) {\n        bestPosition = new BoxPosition(b);\n        percentage = p;\n      }\n      // Reset the box position to the specified position.\n      b = new BoxPosition(specifiedPosition);\n    }\n    return bestPosition || specifiedPosition;\n  }\n\n  var boxPosition = new BoxPosition(styleBox),\n      cue = styleBox.cue,\n      linePos = computeLinePos(cue),\n      axis = [];\n\n  // If we have a line number to align the cue to.\n  if (cue.snapToLines) {\n    var size;\n    switch (cue.vertical) {\n    case \"\":\n      axis = [ \"+y\", \"-y\" ];\n      size = \"height\";\n      break;\n    case \"rl\":\n      axis = [ \"+x\", \"-x\" ];\n      size = \"width\";\n      break;\n    case \"lr\":\n      axis = [ \"-x\", \"+x\" ];\n      size = \"width\";\n      break;\n    }\n\n    var step = boxPosition.lineHeight,\n        position = step * Math.round(linePos),\n        maxPosition = containerBox[size] + step,\n        initialAxis = axis[0];\n\n    // If the specified intial position is greater then the max position then\n    // clamp the box to the amount of steps it would take for the box to\n    // reach the max position.\n    if (Math.abs(position) > maxPosition) {\n      position = position < 0 ? -1 : 1;\n      position *= Math.ceil(maxPosition / step) * step;\n    }\n\n    // If computed line position returns negative then line numbers are\n    // relative to the bottom of the video instead of the top. Therefore, we\n    // need to increase our initial position by the length or width of the\n    // video, depending on the writing direction, and reverse our axis directions.\n    if (linePos < 0) {\n      position += cue.vertical === \"\" ? containerBox.height : containerBox.width;\n      axis = axis.reverse();\n    }\n\n    // Move the box to the specified position. This may not be its best\n    // position.\n    boxPosition.move(initialAxis, position);\n\n  } else {\n    // If we have a percentage line value for the cue.\n    var calculatedPercentage = (boxPosition.lineHeight / containerBox.height) * 100;\n\n    switch (cue.lineAlign) {\n    case \"center\":\n      linePos -= (calculatedPercentage / 2);\n      break;\n    case \"end\":\n      linePos -= calculatedPercentage;\n      break;\n    }\n\n    // Apply initial line position to the cue box.\n    switch (cue.vertical) {\n    case \"\":\n      styleBox.applyStyles({\n        top: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    case \"rl\":\n      styleBox.applyStyles({\n        left: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    case \"lr\":\n      styleBox.applyStyles({\n        right: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    }\n\n    axis = [ \"+y\", \"-x\", \"+x\", \"-y\" ];\n\n    // Get the box position again after we've applied the specified positioning\n    // to it.\n    boxPosition = new BoxPosition(styleBox);\n  }\n\n  var bestPosition = findBestPosition(boxPosition, axis);\n  styleBox.move(bestPosition.toCSSCompatValues(containerBox));\n}\n\nfunction WebVTT() {\n  // Nothing\n}\n\n// Helper to allow strings to be decoded instead of the default binary utf8 data.\nWebVTT.StringDecoder = function() {\n  return {\n    decode: function(data) {\n      if (!data) {\n        return \"\";\n      }\n      if (typeof data !== \"string\") {\n        throw new Error(\"Error - expected string data.\");\n      }\n      return decodeURIComponent(encodeURIComponent(data));\n    }\n  };\n};\n\nWebVTT.convertCueToDOMTree = function(window, cuetext) {\n  if (!window || !cuetext) {\n    return null;\n  }\n  return parseContent(window, cuetext);\n};\n\nvar FONT_SIZE_PERCENT = 0.05;\nvar FONT_STYLE = \"sans-serif\";\nvar CUE_BACKGROUND_PADDING = \"1.5%\";\n\n// Runs the processing model over the cues and regions passed to it.\n// @param overlay A block level element (usually a div) that the computed cues\n//                and regions will be placed into.\nWebVTT.processCues = function(window, cues, overlay) {\n  if (!window || !cues || !overlay) {\n    return null;\n  }\n\n  // Remove all previous children.\n  while (overlay.firstChild) {\n    overlay.removeChild(overlay.firstChild);\n  }\n\n  var paddedOverlay = window.document.createElement(\"div\");\n  paddedOverlay.style.position = \"absolute\";\n  paddedOverlay.style.left = \"0\";\n  paddedOverlay.style.right = \"0\";\n  paddedOverlay.style.top = \"0\";\n  paddedOverlay.style.bottom = \"0\";\n  paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\n  overlay.appendChild(paddedOverlay);\n\n  // Determine if we need to compute the display states of the cues. This could\n  // be the case if a cue's state has been changed since the last computation or\n  // if it has not been computed yet.\n  function shouldCompute(cues) {\n    for (var i = 0; i < cues.length; i++) {\n      if (cues[i].hasBeenReset || !cues[i].displayState) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // We don't need to recompute the cues' display states. Just reuse them.\n  if (!shouldCompute(cues)) {\n    for (var i = 0; i < cues.length; i++) {\n      paddedOverlay.appendChild(cues[i].displayState);\n    }\n    return;\n  }\n\n  var boxPositions = [],\n      containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay),\n      fontSize = Math.round(containerBox.height * FONT_SIZE_PERCENT * 100) / 100;\n  var styleOptions = {\n    font: fontSize + \"px \" + FONT_STYLE\n  };\n\n  (function() {\n    var styleBox, cue;\n\n    for (var i = 0; i < cues.length; i++) {\n      cue = cues[i];\n\n      // Compute the intial position and styles of the cue div.\n      styleBox = new CueStyleBox(window, cue, styleOptions);\n      paddedOverlay.appendChild(styleBox.div);\n\n      // Move the cue div to it's correct line position.\n      moveBoxToLinePosition(window, styleBox, containerBox, boxPositions);\n\n      // Remember the computed div so that we don't have to recompute it later\n      // if we don't have too.\n      cue.displayState = styleBox.div;\n\n      boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\n    }\n  })();\n};\n\nWebVTT.Parser = function(window, vttjs, decoder) {\n  if (!decoder) {\n    decoder = vttjs;\n    vttjs = {};\n  }\n  if (!vttjs) {\n    vttjs = {};\n  }\n\n  this.window = window;\n  this.vttjs = vttjs;\n  this.state = \"INITIAL\";\n  this.buffer = \"\";\n  this.decoder = decoder || new TextDecoder(\"utf8\");\n  this.regionList = [];\n};\n\nWebVTT.Parser.prototype = {\n  // If the error is a ParsingError then report it to the consumer if\n  // possible. If it's not a ParsingError then throw it like normal.\n  reportOrThrowError: function(e) {\n    if (e instanceof ParsingError) {\n      this.onparsingerror && this.onparsingerror(e);\n    } else {\n      throw e;\n    }\n  },\n  parse: function (data) {\n    var self = this;\n\n    // If there is no data then we won't decode it, but will just try to parse\n    // whatever is in buffer already. This may occur in circumstances, for\n    // example when flush() is called.\n    if (data) {\n      // Try to decode the data that we received.\n      self.buffer += self.decoder.decode(data, {stream: true});\n    }\n\n    function collectNextLine() {\n      var buffer = self.buffer;\n      var pos = 0;\n      while (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\n        ++pos;\n      }\n      var line = buffer.substr(0, pos);\n      // Advance the buffer early in case we fail below.\n      if (buffer[pos] === '\\r') {\n        ++pos;\n      }\n      if (buffer[pos] === '\\n') {\n        ++pos;\n      }\n      self.buffer = buffer.substr(pos);\n      return line;\n    }\n\n    // 3.4 WebVTT region and WebVTT region settings syntax\n    function parseRegion(input) {\n      var settings = new Settings();\n\n      parseOptions(input, function (k, v) {\n        switch (k) {\n        case \"id\":\n          settings.set(k, v);\n          break;\n        case \"width\":\n          settings.percent(k, v);\n          break;\n        case \"lines\":\n          settings.integer(k, v);\n          break;\n        case \"regionanchor\":\n        case \"viewportanchor\":\n          var xy = v.split(',');\n          if (xy.length !== 2) {\n            break;\n          }\n          // We have to make sure both x and y parse, so use a temporary\n          // settings object here.\n          var anchor = new Settings();\n          anchor.percent(\"x\", xy[0]);\n          anchor.percent(\"y\", xy[1]);\n          if (!anchor.has(\"x\") || !anchor.has(\"y\")) {\n            break;\n          }\n          settings.set(k + \"X\", anchor.get(\"x\"));\n          settings.set(k + \"Y\", anchor.get(\"y\"));\n          break;\n        case \"scroll\":\n          settings.alt(k, v, [\"up\"]);\n          break;\n        }\n      }, /=/, /\\s/);\n\n      // Create the region, using default values for any values that were not\n      // specified.\n      if (settings.has(\"id\")) {\n        var region = new (self.vttjs.VTTRegion || self.window.VTTRegion)();\n        region.width = settings.get(\"width\", 100);\n        region.lines = settings.get(\"lines\", 3);\n        region.regionAnchorX = settings.get(\"regionanchorX\", 0);\n        region.regionAnchorY = settings.get(\"regionanchorY\", 100);\n        region.viewportAnchorX = settings.get(\"viewportanchorX\", 0);\n        region.viewportAnchorY = settings.get(\"viewportanchorY\", 100);\n        region.scroll = settings.get(\"scroll\", \"\");\n        // Register the region.\n        self.onregion && self.onregion(region);\n        // Remember the VTTRegion for later in case we parse any VTTCues that\n        // reference it.\n        self.regionList.push({\n          id: settings.get(\"id\"),\n          region: region\n        });\n      }\n    }\n\n    // draft-pantos-http-live-streaming-20\n    // https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-3.5\n    // 3.5 WebVTT\n    function parseTimestampMap(input) {\n      var settings = new Settings();\n\n      parseOptions(input, function(k, v) {\n        switch(k) {\n        case \"MPEGT\":\n          settings.integer(k + 'S', v);\n          break;\n        case \"LOCA\":\n          settings.set(k + 'L', parseTimeStamp(v));\n          break;\n        }\n      }, /[^\\d]:/, /,/);\n\n      self.ontimestampmap && self.ontimestampmap({\n        \"MPEGTS\": settings.get(\"MPEGTS\"),\n        \"LOCAL\": settings.get(\"LOCAL\")\n      });\n    }\n\n    // 3.2 WebVTT metadata header syntax\n    function parseHeader(input) {\n      if (input.match(/X-TIMESTAMP-MAP/)) {\n        // This line contains HLS X-TIMESTAMP-MAP metadata\n        parseOptions(input, function(k, v) {\n          switch(k) {\n          case \"X-TIMESTAMP-MAP\":\n            parseTimestampMap(v);\n            break;\n          }\n        }, /=/);\n      } else {\n        parseOptions(input, function (k, v) {\n          switch (k) {\n          case \"Region\":\n            // 3.3 WebVTT region metadata header syntax\n            parseRegion(v);\n            break;\n          }\n        }, /:/);\n      }\n\n    }\n\n    // 5.1 WebVTT file parsing.\n    try {\n      var line;\n      if (self.state === \"INITIAL\") {\n        // We can't start parsing until we have the first line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        line = collectNextLine();\n\n        var m = line.match(/^WEBVTT([ \\t].*)?$/);\n        if (!m || !m[0]) {\n          throw new ParsingError(ParsingError.Errors.BadSignature);\n        }\n\n        self.state = \"HEADER\";\n      }\n\n      var alreadyCollectedLine = false;\n      while (self.buffer) {\n        // We can't parse a line until we have the full line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        if (!alreadyCollectedLine) {\n          line = collectNextLine();\n        } else {\n          alreadyCollectedLine = false;\n        }\n\n        switch (self.state) {\n        case \"HEADER\":\n          // 13-18 - Allow a header (metadata) under the WEBVTT line.\n          if (/:/.test(line)) {\n            parseHeader(line);\n          } else if (!line) {\n            // An empty line terminates the header and starts the body (cues).\n            self.state = \"ID\";\n          }\n          continue;\n        case \"NOTE\":\n          // Ignore NOTE blocks.\n          if (!line) {\n            self.state = \"ID\";\n          }\n          continue;\n        case \"ID\":\n          // Check for the start of NOTE blocks.\n          if (/^NOTE($|[ \\t])/.test(line)) {\n            self.state = \"NOTE\";\n            break;\n          }\n          // 19-29 - Allow any number of line terminators, then initialize new cue values.\n          if (!line) {\n            continue;\n          }\n          self.cue = new (self.vttjs.VTTCue || self.window.VTTCue)(0, 0, \"\");\n          // Safari still uses the old middle value and won't accept center\n          try {\n            self.cue.align = \"center\";\n          } catch (e) {\n            self.cue.align = \"middle\";\n          }\n          self.state = \"CUE\";\n          // 30-39 - Check if self line contains an optional identifier or timing data.\n          if (line.indexOf(\"-->\") === -1) {\n            self.cue.id = line;\n            continue;\n          }\n          // Process line as start of a cue.\n          /*falls through*/\n        case \"CUE\":\n          // 40 - Collect cue timings and settings.\n          try {\n            parseCue(line, self.cue, self.regionList);\n          } catch (e) {\n            self.reportOrThrowError(e);\n            // In case of an error ignore rest of the cue.\n            self.cue = null;\n            self.state = \"BADCUE\";\n            continue;\n          }\n          self.state = \"CUETEXT\";\n          continue;\n        case \"CUETEXT\":\n          var hasSubstring = line.indexOf(\"-->\") !== -1;\n          // 34 - If we have an empty line then report the cue.\n          // 35 - If we have the special substring '-->' then report the cue,\n          // but do not collect the line as we need to process the current\n          // one as a new cue.\n          if (!line || hasSubstring && (alreadyCollectedLine = true)) {\n            // We are done parsing self cue.\n            self.oncue && self.oncue(self.cue);\n            self.cue = null;\n            self.state = \"ID\";\n            continue;\n          }\n          if (self.cue.text) {\n            self.cue.text += \"\\n\";\n          }\n          self.cue.text += line.replace(/\\u2028/g, '\\n').replace(/u2029/g, '\\n');\n          continue;\n        case \"BADCUE\": // BADCUE\n          // 54-62 - Collect and discard the remaining cue.\n          if (!line) {\n            self.state = \"ID\";\n          }\n          continue;\n        }\n      }\n    } catch (e) {\n      self.reportOrThrowError(e);\n\n      // If we are currently parsing a cue, report what we have.\n      if (self.state === \"CUETEXT\" && self.cue && self.oncue) {\n        self.oncue(self.cue);\n      }\n      self.cue = null;\n      // Enter BADWEBVTT state if header was not parsed correctly otherwise\n      // another exception occurred so enter BADCUE state.\n      self.state = self.state === \"INITIAL\" ? \"BADWEBVTT\" : \"BADCUE\";\n    }\n    return this;\n  },\n  flush: function () {\n    var self = this;\n    try {\n      // Finish decoding the stream.\n      self.buffer += self.decoder.decode();\n      // Synthesize the end of the current cue or region.\n      if (self.cue || self.state === \"HEADER\") {\n        self.buffer += \"\\n\\n\";\n        self.parse();\n      }\n      // If we've flushed, parsed, and we're still on the INITIAL state then\n      // that means we don't have enough of the stream to parse the first\n      // line.\n      if (self.state === \"INITIAL\") {\n        throw new ParsingError(ParsingError.Errors.BadSignature);\n      }\n    } catch(e) {\n      self.reportOrThrowError(e);\n    }\n    self.onflush && self.onflush();\n    return this;\n  }\n};\n\nmodule.exports = WebVTT;\n"]},"metadata":{},"sourceType":"script"}