{"ast":null,"code":"import { createReducer } from '@reduxjs/toolkit';\nimport { getVersionUpgrade, VersionUpgrade } from '@uniswap/token-lists'; // eslint-disable-next-line import/no-unresolved\n\nimport { DEFAULT_LIST_OF_LISTS, DEFAULT_TOKEN_LIST_URL } from '../../constants/lists';\nimport { updateVersion } from '../global/actions';\nimport { acceptListUpdate, addList, fetchTokenList, removeList, selectList } from './actions';\nimport DEFAULT_LIST from '../../constants/token/pancakeswap.json';\nconst NEW_LIST_STATE = {\n  error: null,\n  current: null,\n  loadingRequestId: null,\n  pendingUpdate: null\n};\nconst initialState = {\n  lastInitializedDefaultListOfLists: DEFAULT_LIST_OF_LISTS,\n  byUrl: { ...DEFAULT_LIST_OF_LISTS.reduce((memo, listUrl) => {\n      memo[listUrl] = NEW_LIST_STATE;\n      return memo;\n    }, {}),\n    [DEFAULT_TOKEN_LIST_URL]: {\n      error: null,\n      current: DEFAULT_LIST,\n      loadingRequestId: null,\n      pendingUpdate: null\n    }\n  },\n  selectedListUrl: DEFAULT_TOKEN_LIST_URL\n};\nexport default createReducer(initialState, builder => builder.addCase(fetchTokenList.pending, (state, {\n  payload: {\n    requestId,\n    url\n  }\n}) => {\n  state.byUrl[url] = {\n    current: null,\n    pendingUpdate: null,\n    ...state.byUrl[url],\n    loadingRequestId: requestId,\n    error: null\n  };\n}).addCase(fetchTokenList.fulfilled, (state, {\n  payload: {\n    requestId,\n    tokenList,\n    url\n  }\n}) => {\n  var _state$byUrl$url, _state$byUrl$url2;\n\n  const current = (_state$byUrl$url = state.byUrl[url]) === null || _state$byUrl$url === void 0 ? void 0 : _state$byUrl$url.current;\n  const loadingRequestId = (_state$byUrl$url2 = state.byUrl[url]) === null || _state$byUrl$url2 === void 0 ? void 0 : _state$byUrl$url2.loadingRequestId; // no-op if update does nothing\n\n  if (current) {\n    const upgradeType = getVersionUpgrade(current.version, tokenList.version);\n    if (upgradeType === VersionUpgrade.NONE) return;\n\n    if (loadingRequestId === null || loadingRequestId === requestId) {\n      state.byUrl[url] = { ...state.byUrl[url],\n        loadingRequestId: null,\n        error: null,\n        current,\n        pendingUpdate: tokenList\n      };\n    }\n  } else {\n    state.byUrl[url] = { ...state.byUrl[url],\n      loadingRequestId: null,\n      error: null,\n      current: tokenList,\n      pendingUpdate: null\n    };\n  }\n}).addCase(fetchTokenList.rejected, (state, {\n  payload: {\n    url,\n    requestId,\n    errorMessage\n  }\n}) => {\n  var _state$byUrl$url3;\n\n  if (((_state$byUrl$url3 = state.byUrl[url]) === null || _state$byUrl$url3 === void 0 ? void 0 : _state$byUrl$url3.loadingRequestId) !== requestId) {\n    // no-op since it's not the latest request\n    return;\n  }\n\n  state.byUrl[url] = { ...state.byUrl[url],\n    loadingRequestId: null,\n    error: errorMessage,\n    current: null,\n    pendingUpdate: null\n  };\n}).addCase(selectList, (state, {\n  payload: url\n}) => {\n  state.selectedListUrl = url; // automatically adds list\n\n  if (!state.byUrl[url]) {\n    state.byUrl[url] = NEW_LIST_STATE;\n  }\n}).addCase(addList, (state, {\n  payload: url\n}) => {\n  if (!state.byUrl[url]) {\n    state.byUrl[url] = NEW_LIST_STATE;\n  }\n}).addCase(removeList, (state, {\n  payload: url\n}) => {\n  if (state.byUrl[url]) {\n    delete state.byUrl[url];\n  }\n\n  if (state.selectedListUrl === url) {\n    state.selectedListUrl = Object.keys(state.byUrl)[0];\n  }\n}).addCase(acceptListUpdate, (state, {\n  payload: url\n}) => {\n  var _state$byUrl$url4;\n\n  if (!((_state$byUrl$url4 = state.byUrl[url]) === null || _state$byUrl$url4 === void 0 ? void 0 : _state$byUrl$url4.pendingUpdate)) {\n    throw new Error('accept list update called without pending update');\n  }\n\n  state.byUrl[url] = { ...state.byUrl[url],\n    pendingUpdate: null,\n    current: state.byUrl[url].pendingUpdate\n  };\n}).addCase(updateVersion, state => {\n  // state loaded from localStorage, but new lists have never been initialized\n  if (!state.lastInitializedDefaultListOfLists) {\n    state.byUrl = initialState.byUrl;\n    state.selectedListUrl = undefined;\n  } else if (state.lastInitializedDefaultListOfLists) {\n    const lastInitializedSet = state.lastInitializedDefaultListOfLists.reduce((s, l) => s.add(l), new Set());\n    const newListOfListsSet = DEFAULT_LIST_OF_LISTS.reduce((s, l) => s.add(l), new Set());\n    DEFAULT_LIST_OF_LISTS.forEach(listUrl => {\n      if (!lastInitializedSet.has(listUrl)) {\n        state.byUrl[listUrl] = NEW_LIST_STATE;\n      }\n    });\n    state.lastInitializedDefaultListOfLists.forEach(listUrl => {\n      if (!newListOfListsSet.has(listUrl)) {\n        delete state.byUrl[listUrl];\n      }\n    });\n  }\n\n  state.lastInitializedDefaultListOfLists = DEFAULT_LIST_OF_LISTS;\n}));","map":{"version":3,"sources":["/Users/cj/Desktop/swap-attempts/swap2/src/state/lists/reducer.ts"],"names":["createReducer","getVersionUpgrade","VersionUpgrade","DEFAULT_LIST_OF_LISTS","DEFAULT_TOKEN_LIST_URL","updateVersion","acceptListUpdate","addList","fetchTokenList","removeList","selectList","DEFAULT_LIST","NEW_LIST_STATE","error","current","loadingRequestId","pendingUpdate","initialState","lastInitializedDefaultListOfLists","byUrl","reduce","memo","listUrl","selectedListUrl","builder","addCase","pending","state","payload","requestId","url","fulfilled","tokenList","upgradeType","version","NONE","rejected","errorMessage","Object","keys","Error","undefined","lastInitializedSet","s","l","add","Set","newListOfListsSet","forEach","has"],"mappings":"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","sourcesContent":["import { createReducer } from '@reduxjs/toolkit'\nimport { getVersionUpgrade, VersionUpgrade } from '@uniswap/token-lists'\n// eslint-disable-next-line import/no-unresolved\nimport { TokenList } from '@uniswap/token-lists/dist/types'\nimport { DEFAULT_LIST_OF_LISTS, DEFAULT_TOKEN_LIST_URL } from '../../constants/lists'\nimport { updateVersion } from '../global/actions'\nimport { acceptListUpdate, addList, fetchTokenList, removeList, selectList } from './actions'\nimport DEFAULT_LIST from '../../constants/token/pancakeswap.json'\n\nexport interface ListsState {\n  readonly byUrl: {\n    readonly [url: string]: {\n      readonly current: TokenList | null\n      readonly pendingUpdate: TokenList | null\n      readonly loadingRequestId: string | null\n      readonly error: string | null\n    }\n  }\n  // this contains the default list of lists from the last time the updateVersion was called, i.e. the app was reloaded\n  readonly lastInitializedDefaultListOfLists?: string[]\n  readonly selectedListUrl: string | undefined\n}\n\nconst NEW_LIST_STATE: ListsState['byUrl'][string] = {\n  error: null,\n  current: null,\n  loadingRequestId: null,\n  pendingUpdate: null,\n}\n\ntype Mutable<T> = { -readonly [P in keyof T]: T[P] extends ReadonlyArray<infer U> ? U[] : T[P] }\n\nconst initialState: ListsState = {\n  lastInitializedDefaultListOfLists: DEFAULT_LIST_OF_LISTS,\n  byUrl: {\n    ...DEFAULT_LIST_OF_LISTS.reduce<Mutable<ListsState['byUrl']>>((memo, listUrl) => {\n      memo[listUrl] = NEW_LIST_STATE\n      return memo\n    }, {}),\n    [DEFAULT_TOKEN_LIST_URL]: {\n      error: null,\n      current: DEFAULT_LIST,\n      loadingRequestId: null,\n      pendingUpdate: null,\n    },\n  },\n  selectedListUrl: DEFAULT_TOKEN_LIST_URL,\n}\n\nexport default createReducer(initialState, (builder) =>\n  builder\n    .addCase(fetchTokenList.pending, (state, { payload: { requestId, url } }) => {\n      state.byUrl[url] = {\n        current: null,\n        pendingUpdate: null,\n        ...state.byUrl[url],\n        loadingRequestId: requestId,\n        error: null,\n      }\n    })\n    .addCase(fetchTokenList.fulfilled, (state, { payload: { requestId, tokenList, url } }) => {\n      const current = state.byUrl[url]?.current\n      const loadingRequestId = state.byUrl[url]?.loadingRequestId\n\n      // no-op if update does nothing\n      if (current) {\n        const upgradeType = getVersionUpgrade(current.version, tokenList.version)\n        if (upgradeType === VersionUpgrade.NONE) return\n        if (loadingRequestId === null || loadingRequestId === requestId) {\n          state.byUrl[url] = {\n            ...state.byUrl[url],\n            loadingRequestId: null,\n            error: null,\n            current,\n            pendingUpdate: tokenList,\n          }\n        }\n      } else {\n        state.byUrl[url] = {\n          ...state.byUrl[url],\n          loadingRequestId: null,\n          error: null,\n          current: tokenList,\n          pendingUpdate: null,\n        }\n      }\n    })\n    .addCase(fetchTokenList.rejected, (state, { payload: { url, requestId, errorMessage } }) => {\n      if (state.byUrl[url]?.loadingRequestId !== requestId) {\n        // no-op since it's not the latest request\n        return\n      }\n\n      state.byUrl[url] = {\n        ...state.byUrl[url],\n        loadingRequestId: null,\n        error: errorMessage,\n        current: null,\n        pendingUpdate: null,\n      }\n    })\n    .addCase(selectList, (state, { payload: url }) => {\n      state.selectedListUrl = url\n      // automatically adds list\n      if (!state.byUrl[url]) {\n        state.byUrl[url] = NEW_LIST_STATE\n      }\n    })\n    .addCase(addList, (state, { payload: url }) => {\n      if (!state.byUrl[url]) {\n        state.byUrl[url] = NEW_LIST_STATE\n      }\n    })\n    .addCase(removeList, (state, { payload: url }) => {\n      if (state.byUrl[url]) {\n        delete state.byUrl[url]\n      }\n      if (state.selectedListUrl === url) {\n        state.selectedListUrl = Object.keys(state.byUrl)[0]\n      }\n    })\n    .addCase(acceptListUpdate, (state, { payload: url }) => {\n      if (!state.byUrl[url]?.pendingUpdate) {\n        throw new Error('accept list update called without pending update')\n      }\n      state.byUrl[url] = {\n        ...state.byUrl[url],\n        pendingUpdate: null,\n        current: state.byUrl[url].pendingUpdate,\n      }\n    })\n    .addCase(updateVersion, (state) => {\n      // state loaded from localStorage, but new lists have never been initialized\n      if (!state.lastInitializedDefaultListOfLists) {\n        state.byUrl = initialState.byUrl\n        state.selectedListUrl = undefined\n      } else if (state.lastInitializedDefaultListOfLists) {\n        const lastInitializedSet = state.lastInitializedDefaultListOfLists.reduce<Set<string>>(\n          (s, l) => s.add(l),\n          new Set()\n        )\n        const newListOfListsSet = DEFAULT_LIST_OF_LISTS.reduce<Set<string>>((s, l) => s.add(l), new Set())\n\n        DEFAULT_LIST_OF_LISTS.forEach((listUrl) => {\n          if (!lastInitializedSet.has(listUrl)) {\n            state.byUrl[listUrl] = NEW_LIST_STATE\n          }\n        })\n\n        state.lastInitializedDefaultListOfLists.forEach((listUrl) => {\n          if (!newListOfListsSet.has(listUrl)) {\n            delete state.byUrl[listUrl]\n          }\n        })\n      }\n\n      state.lastInitializedDefaultListOfLists = DEFAULT_LIST_OF_LISTS\n    })\n)\n"]},"metadata":{},"sourceType":"module"}