{"version":3,"file":"walletlink-connector.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\n\nconst CHAIN_ID = 1\n\ninterface WalletLinkConnectorArguments {\n  url: string\n  appName: string\n  appLogoUrl?: string\n  darkMode?: boolean\n}\n\nexport class WalletLinkConnector extends AbstractConnector {\n  private readonly url: string\n  private readonly appName: string\n  private readonly appLogoUrl?: string\n  private readonly darkMode: boolean\n\n  public walletLink: any\n  private provider: any\n\n  constructor({ url, appName, appLogoUrl, darkMode }: WalletLinkConnectorArguments) {\n    super({ supportedChainIds: [CHAIN_ID] })\n\n    this.url = url\n    this.appName = appName\n    this.appLogoUrl = appLogoUrl\n    this.darkMode = darkMode || false\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    if (!this.walletLink) {\n      const WalletLink = await import('walletlink').then(m => m?.default ?? m)\n      this.walletLink = new WalletLink({\n        appName: this.appName,\n        darkMode: this.darkMode,\n        ...(this.appLogoUrl ? { appLogoUrl: this.appLogoUrl } : {})\n      })\n      this.provider = this.walletLink.makeWeb3Provider(this.url, CHAIN_ID)\n    }\n\n    const account = await this.provider.send('eth_requestAccounts').then((accounts: string[]): string => accounts[0])\n\n    this.provider.on('chainChanged', this.handleChainChanged)\n    this.provider.on('accountsChanged', this.handleAccountsChanged)\n\n    return { provider: this.provider, chainId: CHAIN_ID, account: account }\n  }\n\n  public async getProvider(): Promise<any> {\n    return this.provider\n  }\n\n  public async getChainId(): Promise<number> {\n    return CHAIN_ID\n  }\n\n  public async getAccount(): Promise<null | string> {\n    return this.provider.send('eth_accounts').then((accounts: string[]): string => accounts[0])\n  }\n\n  public deactivate() {\n    this.provider.removeListener('chainChanged', this.handleChainChanged)\n    this.provider.removeListener('accountsChanged', this.handleAccountsChanged)\n  }\n\n  public async close() {\n    this.provider.close()\n    this.emitDeactivate()\n  }\n\n  private handleChainChanged(chainId: number | string): void {\n    if (__DEV__) {\n      console.log(\"Handling 'chainChanged' event with payload\", chainId)\n    }\n    this.emitUpdate({ chainId })\n  }\n\n  private handleAccountsChanged(accounts: string[]): void {\n    if (__DEV__) {\n      console.log(\"Handling 'accountsChanged' event with payload\", accounts)\n    }\n    this.emitUpdate({ account: accounts[0] })\n  }\n}\n"],"names":["CHAIN_ID","WalletLinkConnector","url","appName","appLogoUrl","darkMode","supportedChainIds","activate","provider","send","then","accounts","account","on","handleChainChanged","handleAccountsChanged","chainId","walletLink","m","WalletLink","makeWeb3Provider","getProvider","getChainId","getAccount","deactivate","removeListener","close","emitDeactivate","console","log","emitUpdate","AbstractConnector"],"mappings":"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"}